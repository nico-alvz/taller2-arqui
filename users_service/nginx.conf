# Modo primer plano y logging a stdout/stderr
daemon off;
worker_processes auto;
error_log /dev/stderr debug;

events { worker_connections 1024; }

http {
  # Logs de acceso y error para que veas en la consola de Render
  access_log /dev/stdout main;
  error_log  /dev/stderr debug;

  server {
    # HTTP/1.1 + HTTP/2 cleartext en el puerto 10000
    listen 10000 http2;

    # ═════ Health-check ═══════════════════════════
    location = /healthz {
      add_header Content-Type text/plain;
      return 200 'OK - Render health check';
    }

    # ═════ gRPC proxy ═════════════════════════════
    location / {
      grpc_pass grpc://127.0.0.1:50052;
      error_page 502 = /error502grpc;
    }

    # ═════ Errores gRPC ════════════════════════════
    location = /error502grpc {
      internal;
      default_type application/grpc;
      add_header grpc-status 14;
      add_header content-length 0;
      return 204;
    }
  }
}
