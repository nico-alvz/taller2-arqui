# /etc/nginx/nginx.conf
worker_processes auto;
error_log /dev/stderr debug;

events {
  worker_connections 1024;
}

http {
  access_log /dev/stdout main;
  error_log  /dev/stderr debug;

  server {
    # Listen HTTP/1.1 + HTTP/2 cleartext on port 10000
    listen 10000 http2;

    # Health-check for Render
    location = /healthz {
      add_header Content-Type text/plain;
      return 200 'OK - Render health check';
    }

    # gRPC proxy: forward everything else to Python on 50052
    location / {
      grpc_pass grpc://127.0.0.1:50052;
      error_page 502 = /error502grpc;
    }

    # Map proxy errors back to gRPC status
    location = /error502grpc {
      internal;
      default_type application/grpc;
      add_header grpc-status 14;
      add_header content-length 0;
      return 204;
    }
  }
}
