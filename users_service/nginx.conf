# nginx.conf
events {}

http {
  server {
    # Escucha HTTP/1.1 y HTTP/2 cleartext (h2c) en el puerto que Render expone
    listen 50051 http2;  # eliminada la segunda línea duplicada

    # Health-check para Render
    location = /healthz {
      add_header Content-Type text/plain;
      return 200 'OK - Render health check';
    }

    # Proxy de todo lo demás como gRPC a tu app en localhost:50052
    location / {
      grpc_pass grpc://127.0.0.1:50052;
      error_page 502 = /error502grpc;
    }

    # Traducción de errores de proxy a gRPC status
    location = /error502grpc {
      internal;
      default_type application/grpc;
      add_header grpc-status 14;
      add_header content-length 0;
      return 204;
    }
  }
}
